# Parasset: Value Reconstruction Based on Oracle
---
## Background

On-chain assets include native assets (completely decentralized and capture value on the chain) and secured assets (undertake some kind of centralized risk and/or requiring certain kind of centralized entity's guarantee, such as USDT). Based on the on-chain price from the oracle, the existing native assets can be used to form all other assets in parallel as long as they have a on-chain price, whether they are native or credit assets. The significance of using such native assets to issue parallel assets is that the underlying assets no longer take any credit risk.

---

## Concepts

### Collateral Assets

Assets which are generally decentralized and native,  were create on the chain, can be used to generate parallel assets, such as ETH, NEST, NHBTC.

### Underlying Assets

Underlying parallel assets, such as ETH, USDT, HBTC, etc.

### Parallel Assets

Assets generated by collateral through protocol, anchored the underlying assets, with an intrinsic value of 1:1, such as pUSD, pETH, pBTC.

---

## The following uses pUSD as an example to illustrate the remaining concepts:

### Collateral Rate

At the beginning of mintage, users need to deposit collateral assets to generate the parallel one, such as pUSD, where the ratio of pUSD generated from per collateral asset to the collateral asset price is less than 1.

### Liquidation Price

When the price of the collateral asset drops, there is a liquidation line above the collateral rate. The liquidation pirce and the collateral rate conform to a certain relationship. The liquidation price is generally 10%-20% higher than the collateral rate.

### Debt Position

After the minting user deposits the collateral assets to the contract, a debt position for custody of the collateral assets is created. When the user redeems the collateral assets from the debt position, the debt deposition ends, and the collateral assets added or re-pledged in the middle share the same debt position.

### Insurance Fund Pool

The insurance fund pool is used to ensure that the exchange relationship between pUSD and USDT is always maintained at a ratio of 1:1 when liquidating. The insurance fund pool can be deposited both pUSD and USDT.

1. When the collateral assets trigger the liquidation line, the collateral assets in the debt position will be transferred to the insurance fund pool, the collateral assets are converted into USDT and pUSD through CoFiX, and destroy the corresponding pUSD in the debt position. If the pUSD in the insurance fund pool is not enough to destroy, a negative account will be formed. Then anyone or liquidation contract can deposit a pUSD, and a value of the negative account will be reduced.
2. Anyone can deposit 1 USDT to the insurance fund pool to generate 1 sUSD at anytime, or return one sUSD to the pool in exchange for one USDT, provided that the insurance fund pool has USDT.

### Oracle

Provides on-chain prices for collateral assets, namely NEST.

### Stability fee

Based on the collateral rate, each debt position has to pay the stability fee according to the difference between the liquidation line and the current price and the time period when adding collateral, minting new coins, redeeming and liquidating.

### Minter

The user who uses collateral assets to mint coins.

### Insurer

LP of insurance fund.

## Operation process

### 1.Minting

The minter deposits the required collateral assets to the contract, and generates stable coins such as pUSD or pETH according to the collateral rate of their choice. At the same time, the system will generate the corresponding debt position and liquidation line.

### 2.Redeem

Before the debt position is liquidated, the minter can return the corresponding amount of stable coins at any time to withdraw the collateral asset.

### 3.Liquidation

Once the collateral asset price is below the liquidation line, anyone can trigger the liquidation. The liquidation according to the following rules: assets in the debt position enter the CoFiX  to trade, and after deducting the liquidator’s income, they are converted into USDT or pUSD (the same as other parallel assets, here uses USD for an example) and destroy the parallel assets corresponding to the debt position. If the pUSD in the insurance fund pool is not enough to be destroyed, a negative account will be formed. Afterwards, anyone who deposits a pUSD will reduce a value of the negative account. See Algorithm 3 for the liquidation process.

### 4.Supplement collateral

At anytime, users can supplement the collateral, which will enter the same debt position, and modify the liquidation line at the same time. See Algorithm 1 for the rule.

### 5.Deposit to Insurance Fund

Anyone can deposit insurance assets to the insurance fund pool. The requirement is the corresponding underlying asset or parallel asset such as USDT or pUSD, or any asset (which will be traded into the underlying asset or parallel asset in CoFiX), and the share is calculated according to the net value after depositing.

### 6.Insurance Withdraw

The insurance funds can be redeem at a designated redeem day. Redemption happends once every 3 months. Each share needs to be held for at least 3 months, and redeem according to the net asset value.

### 7.Minting again

The user can re-mint coins in the original debt position and correct the liquidation line at the same time, correct according to Algorithm 1.

### 8.Fast minting and redemption

Users can deposit 1 USDT to the insurance fund pool to get 1 pUSD, or deposit 1 pUSD for 1 USDT (if there are sufficient asset).

### 9.Stability Fee

The stability fee is calculated according to the block. The stability fee is charged for each operation of coin minting, redemption, supplement collateral, and settlement. See Algorithm 2 for calculation.

### 10.Insurance NAV

The net insurance fund asset value is calculated according to Algorithm 4.

---

## Core algorithm

### Algorithm 1: Collateral rate

For a certain debt vault, the total amount of collateral at time t is denoted as ![image](https://latex.codecogs.com/png.latex?X_{t})，the change in collateral assets is denoted as ![image](https://latex.codecogs.com/png.latex?x_{t}),then：

![image](https://latex.codecogs.com/png.latex?\inline&space;X_{t}=X_{t-1}&plus;x_{t})

The total amount of parallel assets at time t is denoted as ![image](https://latex.codecogs.com/png.latex?Y_{t})，This parallel asset change is recorded as ![image](https://latex.codecogs.com/png.latex?y_{t}),then：

![image](https://latex.codecogs.com/png.latex?\inline&space;Y_{t}=Y_{t-1}&plus;y_{t})

The process of collateral assets ![image](https://latex.codecogs.com/png.latex?X_{t}) will generate debt ![image](https://latex.codecogs.com/png.latex?B_{t})，the calculation formula is as follows：

![image](https://latex.codecogs.com/png.latex?\inline&space;B_{t}=B_{t-1}&plus;b_{t})

#### Notes

1.![image](https://latex.codecogs.com/png.latex?h_{t}) Represents the block height.

2.![image](https://latex.codecogs.com/png.latex?B_{t}) is the total debt mortgaged at ht ![image](https://latex.codecogs.com/png.latex?h_{t}).

3.![image](https://latex.codecogs.com/png.latex?b_{t}) is the amount of change in debt caused by this mortgage or redemption.

4. Initial collateral:

![image](https://latex.codecogs.com/png.latex?%5Cinline%20%5Cleft%5C%7B%5Cbegin%7Bmatrix%7DX_%7Bt%7D%3DX_%7B0%7D%20%5C%5C%20Y_%7B0%7D%3DX_%7B0%7D%5Ctimes%20C_%7B0%7D%5E%7B0%7D%5Ctimes%20P_%7B0%7D%20%5C%5C%20B_%7B0%7D%3DY_%7B0%7D%20%5Cend%7Bmatrix%7D%5Cright.)

among them, ![image](https://latex.codecogs.com/png.latex?\inline&space;C_{0}^{0}) is the initial mortgage rate selected by the investor at the time of the initial mortgage.

5. Full redemption:

![image](https://latex.codecogs.com/png.latex?%5Cinline%20%5Cleft%5C%7B%5Cbegin%7Bmatrix%7DX_%7BN%7D%3D0%20%5C%5C%20Y_%7BN%7D%3D0%20%5C%5C%20B_%7BN%7D%3D0%20%5C%5C%20C_%7BN%7D%3D0%20%5Cend%7Bmatrix%7D%5Cright.)

6. Partial redemption:

![image](https://latex.codecogs.com/png.latex?%5Cinline%20%5Cleft%5C%7B%5Cbegin%7Bmatrix%7Db_%7Bt%7D%3D-R_%7Bt%7D%20%5C%5C%20x_%7Bt%7D%3D%5Cfrac%7BX_%7Bt-1%7D%5Ctimes%20b_%7Bt%7D%7D%7BB_%7Bt%7D%7D%20%5C%5C%20y_%7Bt%7D%3D%5Cfrac%7BY_%7Bt-1%7D%5Ctimes%20b_%7Bt%7D%7D%7BB_%7Bt%7D%7D%20%5Cend%7Bmatrix%7D%5Cright.)

![image](https://latex.codecogs.com/png.latex?R_{t}) is the amount of redemption

7. Mint again：

![image](https://latex.codecogs.com/png.latex?%5Cinline%20%5Cleft%5C%7B%5Cbegin%7Bmatrix%7Dy_%7Bt%7D%3D-x_%7Bt%7D%5Ctimes%20C_%7Bt%7D%5E%7B0%7D%5Ctimes%20P_%7Bt%7D%20%5C%5C%20b_%7Bt%7D%3Dy_%7Bt%7D%20%5Cend%7Bmatrix%7D%5Cright.)

![image](https://latex.codecogs.com/png.latex?C_{t}^{0}) is the initial mortgage rate selected by the investor for remortgage

8. Liquidation line：

![image](https://latex.codecogs.com/png.latex?\inline&space;K_{t}=C_{t}\times&space;k)，where k is a constant

### Algorithm 2: Stability fee

![image](https://latex.codecogs.com/png.latex?\inline&space;S_{t}=B_{t-1}\times&space;r(C_{t-1})\times&space;(h_{t}-h_{t-1}))

#### Notes

1.![image](https://latex.codecogs.com/png.latex?S_{t}) is the stability fee at ![image](https://latex.codecogs.com/png.latex?h_{t}).

2.![image](https://latex.codecogs.com/png.latex?h_{t}) represents the block height.

3.![image](https://latex.codecogs.com/png.latex?B_{t}) is the total amount of debt collateral at ![image](https://latex.codecogs.com/png.latex?h_{t}).

4.![image](https://latex.codecogs.com/png.latex?C_{t}) is the collateral rate at t，the formula as follow：

![image](https://latex.codecogs.com/png.latex?\inline&space;C_{t}=\frac{B_{t}}{P_{t}\times&space;X_{t}})

among them, ![image](https://latex.codecogs.com/png.latex?P_{t}) is the price of the underlying asset ![image](https://latex.codecogs.com/png.latex?X_{t}), which comes from the NEST oracle.

5.![image](https://latex.codecogs.com/png.latex?\inline&space;r(C_{t})) is the dynamic stable rate, it’s calculated as the following: 

![image](https://latex.codecogs.com/png.latex?\inline&space;r(C_{t})=r_{0}\times&space;f(m_{t}/M_{t})\times&space;max(C_{t},0.2))

![image](https://latex.codecogs.com/png.latex?\inline&space;m_{t}) is the remaining debt collateral within the contract, and ![image](https://latex.codecogs.com/png.latex?\inline&space;M_{t}) representing the total circulation of the debt collateral. ![image](https://latex.codecogs.com/png.latex?\inline&space;r_{0}) is the base market rate, ![image](https://latex.codecogs.com/png.latex?\inline&space;f(m_{t}/M_{t})) represent a function of ![image](https://latex.codecogs.com/png.latex?\inline&space;m_{t}/M_{t}) it is not a linear relationship.

6.![image](https://latex.codecogs.com/png.latex?S_{0}=0)

### Algorithm 3: Insurance Fund

The accounts within the insurance fund are: P（parallel）![image](https://latex.codecogs.com/png.latex?\inline&space;Y_{t}^{3}) represents the assets and ![image](https://latex.codecogs.com/png.latex?\inline&space;Z_{t}^{3}) represents the underlying assets. Liquidation of debt to asset is ![image](https://latex.codecogs.com/png.latex?\inline&space;Y_{t}^{1})；liquidated asset is ![image](https://latex.codecogs.com/png.latex?\inline&space;X_{t}^{1}). During the transaction where ![image](https://latex.codecogs.com/png.latex?\inline&space;X_{t}^{1}\rightarrow&space;Y_{t}^{2}&plus;Z_{t}^{2}), eliminating ![image](https://latex.codecogs.com/png.latex?\inline&space;Y_{t}^{1}):

![image](https://latex.codecogs.com/png.latex?%5Cinline%20%5Cleft%5C%7B%5Cbegin%7Bmatrix%7DY_%7Bt%7D%5E%7B3%7D%3DY_%7Bt%7D%5E%7B2%7D&plus;Y_%7Bt-1%7D%5E%7B3%7D-Y_%7Bt%7D%5E%7B1%7D%20%5C%5C%20Z_%7Bt%7D%5E%7B3%7D%3DZ_%7Bt-1%7D%5E%7B3%7D&plus;Z_%7Bt%7D%5E%7B2%7D%20%5Cend%7Bmatrix%7D%5Cright.)

When ![image](https://latex.codecogs.com/png.latex?\inline&space;Y_{t}^{2}&plus;Y_{t-1}^{3}<Y_{t}^{1}) will result in a negative account：at such time, transfer 1Y will get back 1Z, resulting in subtraction of a single value in the negative account. 

### Algorithm 4: Insurance Fund NAV 

![image](https://latex.codecogs.com/png.latex?\inline&space;NP_{t}=\frac{N_{t}}{F_{t}})

#### Equation Breakdown

1.Net asset value:![image](https://latex.codecogs.com/png.latex?\inline&space;N_{t}=Y_{t}^{3}&plus;Z_{t}^{3})

2.![image](https://latex.codecogs.com/png.latex?F_{t}) is the insurance fund share at time t, if initial share is set at ![image](https://latex.codecogs.com/png.latex?F_{0})：

![image](https://latex.codecogs.com/png.latex?\inline&space;F_{t}=F_{t-1}&plus;\Delta&space;F_{t})

meanwhile：![image](https://latex.codecogs.com/png.latex?\inline&space;\Delta&space;F_{t}=\frac{(y_{t}&plus;z_{t})}{NP_{t-1}})，![image](https://latex.codecogs.com/png.latex?y_{t}), ![image](https://latex.codecogs.com/png.latex?z_{t}) representing the assets injected during this time.

